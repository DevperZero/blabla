/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["jazz.cs.Comments"]){dojo._hasResource["jazz.cs.Comments"]=true;(function(){dojo.provide("jazz.cs.Comments");dojo.declare("jazz.cs.Comments",[dijit._Widget,dijit._Templated],{isSubscribed:false,isLoggedIn:false,itemId:null,isAdmin:false,title:null,username:null,userId:null,templateString:"<div>\r\n\t<strong>Discussion</strong>\r\n\t<a href=\"javascript:void(0);\" class=\"subscribe\" id=\"subscribe\" dojoattachevent=\"onclick: _toggleSubscribe\" dojoattachpoint=\"_subscribeButton\">Subscribe me</a>\r\n\t<div dojoattachpoint=\"_comments\"></div>\r\n\t\r\n\t<div dojoattachpoint=\"_loggedInBlock\" style=\"display: none;\">\r\n\t\t<label for=\"comment-field\">Add a comment:</label>\r\n\t\t<textarea dojoattachpoint=\"_commentField\" id=\"comment-field\"></textarea>\r\n\t\t<br />\r\n\t\t<input type=\"button\" value=\"Submit\" dojoattachevent=\"onclick: _submitComment\" />\r\n\t\t<span dojoattachpoint=\"_notify\" class=\"notify\"><input type=\"checkbox\" checked dojoattachpoint=\"_checkNotify\" id=\"check-notify\" /><label for=\"check-notify\">Notify me when a reply is posted</label></span>\r\n\t\t<div dojoattachpoint=\"_subscriptionInfo\" class=\"subscription-info\" style=\"clear: both; display: none;\">You are following this discussion. <a href=\"javascript: void(0);\" dojoattachevent=\"onclick: _toggleSubscribe\">Unsubscribe</a>.</div>\r\n\t</div>\r\n\t<div dojoattachpoint=\"_login\" style=\"display: none;\"><a onclick=\"jazz.cs.showLogin(event)\" href=\"#\"\">Log in</a> to submit a comment.</div>\r\n\r\n<br clear=\"all\">\r\n<div dojoattachpoint=\"_commentFeedback\" class=\"comment-success\" style=\"display: none;\"></div>\r\n\t\r\n</div>\r\n",postCreate:function(){if(this.isSubscribed){this._subscribeButton.innerHTML="Unsubscribe me";dojo.style(this._subscriptionInfo,"display","block");}if(!this.isLoggedIn){dojo.style(this._login,"display","block");}else{dojo.style(this._loggedInBlock,"display","block");}},addComment:function(_1,_2,_3,id,_4){if(this._comments.innerHTML==""){this._comments.innerHTML="<br />";}var _5=new jazz.cs.Comment({username:_1,datePosted:_2,body:jazz.util.html.removeScript(_3),id:id,itemId:this.itemId,isAdmin:this.isAdmin});this._comments.appendChild(_5.domNode);if(_4){dojo.style(_5.domNode,"display","none");dojo.fx.wipeIn({node:_5.domNode},this).play();}},_toggleSubscribe:function(){if(this.isSubscribed){this._subscribeButton.innerHTML="Subscribe me";this._unsubscribe();this.isSubscribed=false;}else{this._subscribeButton.innerHTML="Unsubscribe me";this._subscribe();this.isSubscribed=true;}},_unsubscribe:function(){var _6={url:"/servlet/comment/",handleAs:"json",content:{action:"unsubscribe",itemId:this.itemId,category:"library"},load:dojo.hitch(this,this._unsubscribeLoad),error:function(_7){}};var _8=dojo.xhrPost(_6);},_unsubscribeLoad:function(_9){this._subscriptionInfo.innerHTML="You have been unsubscribed.";dojo.style(this._subscriptionInfo,"display","block");dojo.style(this._subscriptionInfo,"opacity","0");var _a={node:this._subscriptionInfo,duration:1000};dojo.fadeIn(_a).play();},_subscribe:function(){var _b={url:"/servlet/comment/",handleAs:"json",content:{action:"subscribe",itemId:this.itemId,category:"library"},load:dojo.hitch(this,this._subscribeLoad),error:function(_c){}};var _d=dojo.xhrPost(_b);},_subscribeLoad:function(_e){this._subscriptionInfo.innerHTML="You have been subscribed.";dojo.style(this._subscriptionInfo,"display","block");dojo.style(this._subscriptionInfo,"opacity","0");var _f={node:this._subscriptionInfo,duration:1000};dojo.fadeIn(_f).play();},_submitComment:function(){var _10=this._commentField.value;var _11=this._checkNotify.checked;dojo.style(this._commentFeedback,"display","none");if(_10.length>0&&this.isLoggedIn){if(jazz.util.html.hasScript(_10)){dojo.style(this._commentFeedback,"display","block");dojo.removeClass(this._commentFeedback,"comment-success");dojo.addClass(this._commentFeedback,"comment-error");this._commentFeedback.innerHTML="Your comment contains unsafe content (e.g. JavaScript) and cannot be posted.";return;}var _12={url:"/servlet/comment/",handleAs:"json",content:{title:this.title,itemId:this.itemId,category:"library",username:this.username,comment:_10,subscribe:_11},load:dojo.hitch(this,this._commentLoaded),error:dojo.hitch(this,this._commentError)};var _13=dojo.xhrPost(_12);}else{if(!isLoggedIn){dojo.removeClass(this._commentFeedback,"comment-success");dojo.addClass(this._commentFeedback,"comment-error");this._commentFeedback.innerHTML="You must be <a onclick=\"jazz.cs.showLogin(event)\" href=\"#\">logged in</a> to post a comment.";}}},_commentLoaded:function(_14){var _15=this._commentField.value;var _16=this._checkNotify.checked;if(_14.status=="profanity"){dojo.removeClass(this._commentFeedback,"comment-success");dojo.addClass(this._commentFeedback,"comment-error");this._commentFeedback.innerHTML="Your comment contains profanity and cannot be posted.";dojo.style(this._commentFeedback,"display","block");dojo.style(this._commentFeedback,"opacity","0");var _17={node:this._commentFeedback,duration:1000};dojo.fadeIn(_17).play();}else{if(_14.status=="failed"){dojo.removeClass(this._commentFeedback,"comment-success");dojo.addClass(this._commentFeedback,"comment-error");this._commentFeedback.innerHTML="An error occurred submitting your comment.";dojo.style(this._commentFeedback,"display","block");dojo.style(this._commentFeedback,"opacity","0");var _17={node:this._commentFeedback,duration:1000};dojo.fadeIn(_17).play();}else{if(_16==true&&this._notify.style.display!="none"){dojo.style(this._notify,"display","none");dojo.style(this._subscriptionInfo,"display","block");dojo.style(this._subscriptionInfo,"opacity","0");var _17={node:this._subscriptionInfo,duration:1000};dojo.fadeIn(_17).play();}_15=_15.replace(/(<)/g,"&lt;");_15=_15.replace(/(>)/g,"&gt;");_15=_15.replace(/(\n)/g,"<br />");this.addComment(this.username,_14.date,_15,_14.id,true);this._commentField.value="";}}},_commentError:function(_18){dojo.removeClass(this._commentFeedback,"comment-success");dojo.addClass(this._commentFeedback,"comment-error");this._commentFeedback.innerHTML="An error occurred submitting your comment.";dojo.style(this._commentFeedback,"display","block");dojo.style(this._commentFeedback,"opacity","0");var _19={node:this._commentFeedback,duration:1000};dojo.fadeIn(_19).play();}});dojo.provide("jazz.cs.Comment");dojo.declare("jazz.cs.Comment",[dijit._Widget,dijit._Templated],{username:null,datePosted:null,body:null,isAdmin:false,id:null,itemId:null,templateString:"<div class=\"comment\" dojoattachpoint=\"_comment\" dojoattachevent=\"onmouseover: _hover, onmouseout: _hoverOff\">\r\n\t<div class=\"comment-author\"><img class=\"common-sprite icons-userIcon-png\" src=\"/_images/blank.gif\"><strong>${username}</strong> wrote on ${datePosted}:</div>\r\n\t<div class=\"comment-delete\" dojoattachpoint=\"_commentDelete\" dojoattachevent=\"onclick: _deleteComment\"><img src=\"/_images/icons/delete.gif\"></div>\r\n\t<br />\r\n\t<div class=\"comment-content\">\r\n\t\t<blockquote>${body}</blockquote>\r\n\t</div>\r\n</div>\r\n",postCreate:function(){},_hover:function(){if(this.isAdmin){dojo.style(this._commentDelete,"display","block");}},_hoverOff:function(){if(this.isAdmin){dojo.style(this._commentDelete,"display","none");}},_deleteComment:function(){var _1a={url:"/servlet/comment/",handleAs:"json",content:{action:"delete",itemId:this.itemId,id:this.id,category:"library"},load:function(_1b){},error:function(_1c){}};var _1d=dojo.xhrPost(_1a);dojo.fx.wipeOut({node:this._comment}).play();}});})();}if(!dojo._hasResource["jazz.cs.ratings"]){dojo._hasResource["jazz.cs.ratings"]=true;dojo.provide("jazz.cs.ratings");jazz.cs.ratings={currentRating:0,_dialog:null,feedbackDialog:function(){var _1e=dojo.byId("FeedbackDialog");jazz.cs.ratings._dialog=new jazz.ui.Dialog({primaryTitle:"Feedback",contentNode:_1e,width:400});},submitRating:function(_1f,_20,id){dojo.byId("helpful").innerHTML="<img src=\"/_images/home/small-check.png\" width=\"16\" height=\"16\" align=\"absmiddle\"\">Thank you for your feedback.";dojo.style("helpful","opacity","0");var _21={node:"helpful",duration:1000};dojo.fadeIn(_21).play();if(_1f=="true"){dojo.byId("currentRating").innerHTML="";if(_20==1){dojo.byId("currentRating").innerHTML+="You and "+_20+" person";}else{if(_20==0){dojo.byId("currentRating").innerHTML+="You";}else{dojo.byId("currentRating").innerHTML+="You and "+_20+" people";}}}dojo.style("currentRating","opacity","0");var _21={node:"currentRating",duration:1000};dojo.fadeIn(_21).play();var _22={url:"/servlet/rating/",handleAs:"json",content:{category:"library",id:id,isPositive:_1f},load:function(_23){},error:function(_24){console.debug("An error occurred: ",err);}};var _25=dojo.xhrPost(_22);},cancelRating:function(_26,id){dojo.byId("item-rating-favorite").style.display="none";dojo.style("item-rating","opacity","0");dojo.byId("item-rating").style.display="block";var _27={node:"item-rating",duration:1000};dojo.fadeIn(_27).play();dojo.byId("currentRating").innerHTML="";if((_26-1)==1){dojo.byId("currentRating").innerHTML+=(_26-1)+" person";}else{dojo.byId("currentRating").innerHTML+=(_26-1)+" people";}dojo.style("currentRating","opacity","0");var _27={node:"currentRating",duration:1000};dojo.fadeIn(_27).play();var _28={url:"/servlet/rating/",handleAs:"json",content:{category:"library",id:id,isPositive:"cancel"},load:function(_29){},error:function(_2a){console.debug("An error occurred: ",err);}};var _2b=dojo.xhrPost(_28);},submitFeedback:function(_2c,_2d){var _2e=dojo.byId("FeedbackBody").value;dojo.byId("FeedbackDialog").innerHTML="Loading...";var _2f={url:"/servlet/rating/",handleAs:"json",content:{title:_2d,id:_2c,body:_2e},load:function(_30){dojo.byId("FeedbackDialog").innerHTML="<strong>Thank you for your feedback.</strong><p>Your input will be used to make the information on jazz.net more helpful and informative.</p>";setTimeout(function(){jazz.cs.ratings._dialog.close();},4000);},error:function(_31){dojo.byId("FeedbackDialog").innerHTML="An error occurred submitting your feedback.";}};var _32=dojo.xhrPost(_2f);}};}
